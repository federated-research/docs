import { Cards, Tabs, Steps, Callout } from "nextra/components";

# Send the first submission

This page will guide you through sending your first "Hello World" submission to the Five Safes TES weave.

## Prerequisites

- Docker daemon is running.
- Funnel installed and running with Minio access configured. Instructions can be found [here](/five_safes_tes/TES/install_funnel).

## Steps to send the first submission

<Steps>

### Change to directory containing Docker Compose configuration file

Within the **5S-TES-deployment** directory, change to the `AllInOne` directory where the docker compose file of this stack is located:

```
cd AllInOne
```

### Start the Docker Service with `DemoMode = true`

By default, the docker compose file is configured to run in `DemoMode = true`. This will start the stack with the seeding of some demo data and instances.
For example, `Testing` project will be created, TRE named `DEMO` will be deployed, and users credentials used to communicate between apps will be created.

In the same directory as the `docker-compose.yml` file run:

```bash copy
docker compose up -d
```

### Checking Status of Docker Service

The status of the services can be checked using Docker Desktop,
or by running this command:

```bash copy
docker stats
```

### Approve the Project access to the TRE

Follow this [guide](/tre_agent/guides/TREManagerApprovingProject) to approve the project access to the TRE.

To make sure that the project has been approved and Submission Layer is in sync with TRE Agent, choose the project in Submission layer and navigate to the **_TREs_** section.
You should see **_Approved_** status for the TRE.

<img src="/images/ProjectApproved.png" width="400"></img>

### Prepare to send the submission

To send a real submission, some settings need to be adjusted in the `.env` file inside the `AllInOne` directory as follow.

```yaml copy filename=".env"

// Turn off Demo mode to execute analysis:
DemoMode = false

// Allow Keycloak to not require https:
KeyCloakDemoMode = true

// Set UseTESK to true:
UseTESK = true

// Set TesAPIUrl to the URL where the TES API executing agent is hosted. e.g Funnel or TES-K:
TesAPIUrl=http://<HostName>:8000/v1/tasks

// Output bucket prefix for the TES executing agent to write outputs to, default is s3 bucket prefix:
TesOutputBucketPrefix=s3://


```

If using a system-wide installation of `funnel` as the TES API executing agent then the `HostName` should be `host.docker.internal`.

<Callout type="info">
  You need to restart the containers to apply the new configuration. Use the
  following command to restart the containers: `docker compose up -d`
</Callout>

</Steps>

## Troubleshooting

<Tabs items={["Windows"]}>
  <Tabs.Tab>
    <Callout>
      {" "}
      Docker may need access to the file directory to mount the `init.sql` file.
      Add the directory path to the shared paths from `Docker -> Preferences -> Resources
      -> File Sharing`{" "}
    </Callout>
  </Tabs.Tab>
</Tabs>
